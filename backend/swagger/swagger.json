{
  "openapi": "3.0.0",
  "info": {
    "title": "Assessment Microservice API",
    "version": "1.0.0",
    "description": "Auto-generated API docs for Assessment integrations"
  },
  "servers": [
    {
      "url": "/"
    }
  ],
  "paths": {
    "/api/attempts/user/{userId}": {
      "get": {
        "summary": "List attempts for a user",
        "parameters": [
          {
            "in": "path",
            "name": "userId",
            "required": true,
            "schema": {
              "type": "string",
              "example": "u_123"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Success"
          }
        }
      }
    },
    "/api/attempts/{attemptId}": {
      "get": {
        "summary": "Get attempt detail",
        "parameters": [
          {
            "in": "path",
            "name": "attemptId",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Success"
          }
        }
      }
    },
    "/api/attempts/{attemptId}/skills": {
      "get": {
        "summary": "Get attempt per-skill results",
        "parameters": [
          {
            "in": "path",
            "name": "attemptId",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Success"
          }
        }
      }
    },
    "/api/attempts/{attemptId}/remaining_time": {
      "get": {
        "summary": "Get remaining time for an attempt",
        "parameters": [
          {
            "in": "path",
            "name": "attemptId",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Success"
          }
        }
      }
    },
    "/api/exams": {
      "post": {
        "summary": "Create exam (baseline or postcourse)",
        "description": "Creates an exam and initial attempt. Theoretical questions are generated via OpenAI (medium difficulty, mixed types). Coding questions are requested from DevLab. Hints are stored but never returned to the frontend.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "user_id",
                  "exam_type"
                ],
                "properties": {
                  "user_id": {
                    "type": "string",
                    "example": "u_123"
                  },
                  "exam_type": {
                    "type": "string",
                    "enum": [
                      "baseline",
                      "postcourse"
                    ]
                  },
                  "course_id": {
                    "type": "string",
                    "example": "c_789"
                  },
                  "course_name": {
                    "type": "string",
                    "example": "Intro to JS"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Created"
          }
        }
      }
    },
    "/api/exams/{examId}/start": {
      "post": {
        "summary": "Start an exam attempt",
        "description": "Marks attempt as started and returns ExamPackage (policy, skills, coverage_map, questions) with timing fields.",
        "parameters": [
          {
            "in": "path",
            "name": "examId",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "attempt_id"
                ],
                "properties": {
                  "attempt_id": {
                    "type": "integer"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Started",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "exam_id": { "type": "integer" },
                    "attempt_id": { "type": "integer" },
                    "expires_at": { "type": "string", "format": "date-time" },
                    "started_at": { "type": "string", "format": "date-time" },
                    "duration_seconds": { "type": "integer" },
                    "questions": { "type": "array" }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/exams/{examId}/resolve": {
      "get": {
        "summary": "Resolve timing/status for latest attempt of exam",
        "parameters": [
          {
            "in": "path",
            "name": "examId",
            "required": true,
            "schema": { "type": "integer" }
          }
        ],
        "responses": {
          "200": {
            "description": "Resolved",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "exam_id": { "type": "integer" },
                    "attempt_id": { "type": "integer" },
                    "started_at": { "type": "string", "format": "date-time" },
                    "expires_at": { "type": "string", "format": "date-time" },
                    "duration_seconds": { "type": "integer" },
                    "status": { "type": "string", "example": "active|expired|canceled" }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/exams/{examId}/submit": {
      "post": {
        "summary": "Submit an exam attempt",
        "description": "Grades the attempt, upserts per-skill results, and pushes outbox integration payloads.",
        "parameters": [
          {
            "in": "path",
            "name": "examId",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "attempt_id",
                  "answers"
                ],
                "properties": {
                  "attempt_id": {
                    "type": "integer"
                  },
                  "answers": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "required": [
                        "question_id",
                        "type",
                        "skill_id",
                        "answer"
                      ],
                      "properties": {
                        "question_id": {
                          "type": "string"
                        },
                        "type": {
                          "type": "string",
                          "enum": [
                            "mcq",
                            "open",
                            "code"
                          ]
                        },
                        "skill_id": {
                          "type": "string"
                        },
                        "answer": {
                          "type": "string"
                        },
                        "metadata": {
                          "type": "object"
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Submission accepted"
          }
        }
      }
    },
    "/api/fill-content-metrics": {
      "post": {
        "summary": "Universal inbound integration endpoint",
        "description": "Accepts all inbound integration requests via a unified envelope. For DevLab with action=generateTheoretical, returns theoretical questions using OpenAI with difficulty pattern rules.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "requester_service",
                  "stringified_json"
                ],
                "properties": {
                  "requester_service": {
                    "type": "string",
                    "description": "The requesting service name (e.g., coursebuilder, management, directory, skillsengine, devlab, learninganalytics)"
                  },
                  "stringified_json": {
                    "type": "string",
                    "description": "Stringified JSON payload for the request. Example for DevLab theoretical generation: {\"action\":\"generateTheoretical\",\"skill_id\":\"s_js_async\",\"num_questions\":3}"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Accepted envelope processed. For DevLab theoretical, response contains { questions: [...] }."
          },
          "400": {
            "description": "Invalid envelope"
          }
        }
      }
    },
    "/api/packages/{examId}": {
      "get": {
        "summary": "Get ExamPackage by examId",
        "parameters": [
          {
            "in": "path",
            "name": "examId",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Success"
          }
        }
      }
    },
    "/api/proctoring/{attempt_id}/start_camera": {
      "post": {
        "summary": "Activate camera and create proctoring session",
        "description": "Creates or updates a proctoring session for the attempt and sets camera_status=active.",
        "parameters": [
          {
            "in": "path",
            "name": "attempt_id",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Camera activated"
          }
        }
      }
    },
    "/api/proctoring/{attempt_id}/focus_violation": {
      "post": {
        "summary": "Report a focus violation for an attempt",
        "description": "Increments violation count and cancels the attempt on the 3rd violation.",
        "parameters": [
          {
            "in": "path",
            "name": "attempt_id",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Violation recorded"
          }
        }
      }
    }
  },
  "components": {},
  "tags": []
}